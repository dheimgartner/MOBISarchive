# MOBISarchive

Creates monthly .csv batches for the MOBIS-Covid tracking data
- motion_tag_trips
- motion_tag_waypoint
- motion_tag_waypoint_covid

## Usage

Run `make` (wrapper around `main.sh`).

## DB connection

- `sh ./scripts/db.sh` (uses pw from .pgpass)
- or via pgadmin

## Variables

The following variables are available

### Waypoints

- id: Identifier (bigint)
- user_id: User identifier (character varying)
- tracked_at: Tracking date and time (timestamp with timezone)
- created_at: When it was saved in the system (timestamp with timezone)
- latitude: Latitude (double precision)
- longitude: Longitude (double precision)
- geom: Point geometry encoding latitude, longitude (geometry)
- accuracy: Accuracy of the location point provided by the device, in meters (double precision) 
- altitude: Altitude at the location point. Provided by the device, in meters above sea-level (double precision)

### Trips

- uuid: Unique identifier for this trip, generated by motiontag (uuid)
- user_id: User identifier (character varying)
- mt_trip_id: Motion-tag trip id (character varying)
- merged_into_id: This supports the correction interface on motion-tag - that this leg was merged with another one (with that UUID) (integer)
- started_at: Start time and date (timestamp with timezone)
- finished_at: Finishing time and date (timestamp with timezone)
- detected_finished_at: Finishing time and date as detected by the app (timestamp with timezone)
- created_at: When it was saved in the system (timestampe with timezone)
- confirmed_at: Confirmation time and date. Confirming the correctness of the recorded trip was optional (timestampe with timezone)
- updated_at: The last time this trip was changed by the user (timestamp with timezone)
- misdetected_completely: Marked by the user, if the leg didn't take place at all (boolean)
- type: "Track" for legs, "Stay" for activities (character varying)
- length: Length of the stage in meters (double precision)
- detected_length: Length of the stage in meters as detected by the app (double precision)
- detected_mode: Transport mode of the stage originally detected by the app (character varying)
- mode: Transport mode of the stage (character varying)
- geometry: Geometry encoding the trip (geometry)
- detected_geometry: Geometry as detected by the app (geometry)
- purpose: Purpose of the trip (character varying)
- detected_purpose: Purpose as detected by the app (character varying)
- overseas: Trip overseas, not originating in Switzerland (boolean)
